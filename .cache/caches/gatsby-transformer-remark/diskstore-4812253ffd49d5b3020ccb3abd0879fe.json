{"expireTime":9007200843920344000,"key":"transformer-remark-markdown-html-ast-c8b883e4c725b1dd1371bd8fa875d4e2-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Imagine you are a general trying to coordinate an attack together with another friendly general. The only way to win the battle is if both attack at the same time. Both of you have a radio transmitter that can transmit and receive morse code. The transmitter runs of battery, so you cannot keep it on all the time. How do you coordinate the attack?","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":349,"offset":349}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":349,"offset":349}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"The answer is:","position":{"start":{"line":4,"column":2,"offset":352},"end":{"line":4,"column":16,"offset":366}}}],"position":{"start":{"line":4,"column":1,"offset":351},"end":{"line":4,"column":17,"offset":367}}},{"type":"text","value":" Because any message might be lost, there is no way to coordinate the attack with complete certainty.","position":{"start":{"line":4,"column":17,"offset":367},"end":{"line":4,"column":118,"offset":468}}}],"position":{"start":{"line":4,"column":1,"offset":351},"end":{"line":4,"column":118,"offset":468}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You have probably read about that problem before somewhere. The problem might seem staged, but when it comes to computers, it is a real issue. A real issue that has been solved by TCP/IP. In this article, I try to explain the two most popular algorithms for distributed consensus - Paxos and Raft. They solve a similar issue:","position":{"start":{"line":6,"column":1,"offset":470},"end":{"line":6,"column":326,"offset":795}}}],"position":{"start":{"line":6,"column":1,"offset":470},"end":{"line":6,"column":326,"offset":795}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You have a cluster of ","position":{"start":{"line":8,"column":1,"offset":797},"end":{"line":8,"column":23,"offset":819}}},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"n","position":{"start":{"line":8,"column":24,"offset":820},"end":{"line":8,"column":25,"offset":821}}}],"position":{"start":{"line":8,"column":23,"offset":819},"end":{"line":8,"column":26,"offset":822}}},{"type":"text","value":" servers. Each of the servers might fail at any time. A constant flow of random messages hits each of the servers. How do you make the cluster agree on what messages are received and in what order?","position":{"start":{"line":8,"column":26,"offset":822},"end":{"line":8,"column":223,"offset":1019}}}],"position":{"start":{"line":8,"column":1,"offset":797},"end":{"line":8,"column":223,"offset":1019}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"The short answer is:","position":{"start":{"line":10,"column":2,"offset":1022},"end":{"line":10,"column":22,"offset":1042}}}],"position":{"start":{"line":10,"column":1,"offset":1021},"end":{"line":10,"column":23,"offset":1043}}},{"type":"text","value":" It is complicated.","position":{"start":{"line":10,"column":23,"offset":1043},"end":{"line":10,"column":42,"offset":1062}}}],"position":{"start":{"line":10,"column":1,"offset":1021},"end":{"line":10,"column":42,"offset":1062}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"The long answer is:","position":{"start":{"line":12,"column":2,"offset":1065},"end":{"line":12,"column":21,"offset":1084}}}],"position":{"start":{"line":12,"column":1,"offset":1064},"end":{"line":12,"column":22,"offset":1085}}}],"position":{"start":{"line":12,"column":1,"offset":1064},"end":{"line":12,"column":22,"offset":1085}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"What are Distributed-State-Machines?","position":{"start":{"line":14,"column":3,"offset":1089},"end":{"line":14,"column":39,"offset":1125}}}],"position":{"start":{"line":14,"column":1,"offset":1087},"end":{"line":14,"column":39,"offset":1125}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As mentioned above, there are two main algorithms for reaching consensus in a distributed system.","position":{"start":{"line":16,"column":1,"offset":1127},"end":{"line":16,"column":98,"offset":1224}}}],"position":{"start":{"line":16,"column":1,"offset":1127},"end":{"line":16,"column":98,"offset":1224}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before we get to explaining the algorithms, let us look into what reaching consensus in a distributed system means. To understand what that means, it is useful to understand what a state machine is. A state machine is a system that stores a state, and given an action goes to another state. What consensus in a distributed system means is that we are able to treat a system of multiple machines as a state machine. That is useful for programmers because they do not have to think about the distributed nature of the system.","position":{"start":{"line":18,"column":1,"offset":1226},"end":{"line":18,"column":524,"offset":1749}}}],"position":{"start":{"line":18,"column":1,"offset":1226},"end":{"line":18,"column":524,"offset":1749}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"How about giving machines roles?","position":{"start":{"line":20,"column":3,"offset":1753},"end":{"line":20,"column":35,"offset":1785}}}],"position":{"start":{"line":20,"column":1,"offset":1751},"end":{"line":20,"column":35,"offset":1785}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ok, so we are trying to create a distributed state machine. First, consider a system with a single machine. We send a message to the machine and it stores them in the same order as they were received. That machine is the leader.","position":{"start":{"line":22,"column":1,"offset":1787},"end":{"line":22,"column":229,"offset":2015}}}],"position":{"start":{"line":22,"column":1,"offset":1787},"end":{"line":22,"column":229,"offset":2015}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Leader","position":{"start":{"line":24,"column":4,"offset":2020},"end":{"line":24,"column":10,"offset":2026}}}],"position":{"start":{"line":24,"column":1,"offset":2017},"end":{"line":24,"column":10,"offset":2026}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The leader is the machine that receives all the messages. If we only have a single machine, and call that machine the leader it might not be a distributed system, but it gets the basic point across.","position":{"start":{"line":26,"column":1,"offset":2028},"end":{"line":26,"column":199,"offset":2226}}}],"position":{"start":{"line":26,"column":1,"offset":2028},"end":{"line":26,"column":199,"offset":2226}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Followers","position":{"start":{"line":28,"column":4,"offset":2231},"end":{"line":28,"column":13,"offset":2240}}}],"position":{"start":{"line":28,"column":1,"offset":2228},"end":{"line":28,"column":13,"offset":2240}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we have the leader we need more machines in the system. Weâ€™ll call the machines followers. They also store the state of the system and check whether the leader is alive.","position":{"start":{"line":30,"column":1,"offset":2242},"end":{"line":30,"column":175,"offset":2416}}}],"position":{"start":{"line":30,"column":1,"offset":2242},"end":{"line":30,"column":175,"offset":2416}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If they suspect the leader is dead they tries to become the leader.","position":{"start":{"line":32,"column":1,"offset":2418},"end":{"line":32,"column":68,"offset":2485}}}],"position":{"start":{"line":32,"column":1,"offset":2418},"end":{"line":32,"column":68,"offset":2485}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Candidate","position":{"start":{"line":34,"column":4,"offset":2490},"end":{"line":34,"column":13,"offset":2499}}}],"position":{"start":{"line":34,"column":1,"offset":2487},"end":{"line":34,"column":13,"offset":2499}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"That is a machine that is trying to become the new leader. For it to become the leader, all the other machines have to agree that it is the leader.","position":{"start":{"line":36,"column":1,"offset":2501},"end":{"line":36,"column":148,"offset":2648}}}],"position":{"start":{"line":36,"column":1,"offset":2501},"end":{"line":36,"column":148,"offset":2648}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"So what does is the lifecycle?","position":{"start":{"line":38,"column":3,"offset":2652},"end":{"line":38,"column":33,"offset":2682}}}],"position":{"start":{"line":38,"column":1,"offset":2650},"end":{"line":38,"column":33,"offset":2682}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With these roles in place, we have set the play for a lifecycle. Firstly, let us assume that every machine is a follower. The machines then elect a leader.","position":{"start":{"line":40,"column":1,"offset":2684},"end":{"line":40,"column":156,"offset":2839}}}],"position":{"start":{"line":40,"column":1,"offset":2684},"end":{"line":40,"column":156,"offset":2839}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A machine becomes the leader","position":{"start":{"line":42,"column":5,"offset":2845},"end":{"line":42,"column":33,"offset":2873}}}],"position":{"start":{"line":42,"column":1,"offset":2841},"end":{"line":43,"column":1,"offset":2874}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Messages are received by the leader","position":{"start":{"line":44,"column":5,"offset":2879},"end":{"line":44,"column":40,"offset":2914}}}],"position":{"start":{"line":44,"column":1,"offset":2875},"end":{"line":45,"column":1,"offset":2915}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The leader dies","position":{"start":{"line":46,"column":5,"offset":2920},"end":{"line":46,"column":20,"offset":2935}}}],"position":{"start":{"line":46,"column":1,"offset":2916},"end":{"line":47,"column":1,"offset":2936}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Repeatâ€¦","position":{"start":{"line":48,"column":5,"offset":2941},"end":{"line":48,"column":14,"offset":2950}}}],"position":{"start":{"line":48,"column":1,"offset":2937},"end":{"line":48,"column":14,"offset":2950}}},{"type":"text","value":"\n"}],"position":{"start":{"line":42,"column":1,"offset":2841},"end":{"line":48,"column":14,"offset":2950}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You now hopefully understand how the algorithms work.","position":{"start":{"line":50,"column":1,"offset":2952},"end":{"line":50,"column":54,"offset":3005}}}],"position":{"start":{"line":50,"column":1,"offset":2952},"end":{"line":50,"column":54,"offset":3005}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Where do Paxos and Raft differ?","position":{"start":{"line":52,"column":3,"offset":3009},"end":{"line":52,"column":34,"offset":3040}}}],"position":{"start":{"line":52,"column":1,"offset":3007},"end":{"line":52,"column":34,"offset":3040}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In leader election.","position":{"start":{"line":54,"column":1,"offset":3042},"end":{"line":54,"column":20,"offset":3061}}}],"position":{"start":{"line":54,"column":1,"offset":3042},"end":{"line":54,"column":20,"offset":3061}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Paxos requires the leader to be up to date.","position":{"start":{"line":56,"column":1,"offset":3063},"end":{"line":56,"column":44,"offset":3106}}}],"position":{"start":{"line":56,"column":1,"offset":3063},"end":{"line":56,"column":44,"offset":3106}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Raft fetches the messages from the other state machines.","position":{"start":{"line":58,"column":1,"offset":3108},"end":{"line":58,"column":57,"offset":3164}}}],"position":{"start":{"line":58,"column":1,"offset":3108},"end":{"line":58,"column":57,"offset":3164}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"-","position":{"start":{"line":60,"column":1,"offset":3166},"end":{"line":60,"column":2,"offset":3167}}}],"position":{"start":{"line":60,"column":1,"offset":3166},"end":{"line":60,"column":2,"offset":3167}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":61,"column":1,"offset":3168}}}}