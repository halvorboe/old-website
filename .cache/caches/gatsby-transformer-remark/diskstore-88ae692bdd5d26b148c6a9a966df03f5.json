{"expireTime":9007200843919225000,"key":"transformer-remark-markdown-html-ast-c200a88b588920250b775d31735b5599-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Imagine you are a general trying to coordinate an attack together with another friendly general. The only way to win the battle is if both attack at the same time. Both of you have a radio transmitter that can transmit and receive morse code. The transmitter runs of battery, so you cannot keep it on all the time. How do you coordinate the attack?","position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":349,"offset":348}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":349,"offset":348}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"The answer is:","position":{"start":{"line":3,"column":2,"offset":351},"end":{"line":3,"column":16,"offset":365}}}],"position":{"start":{"line":3,"column":1,"offset":350},"end":{"line":3,"column":17,"offset":366}}},{"type":"text","value":" Because any message might be lost, there is no way to coordinate the attack with complete certainty.","position":{"start":{"line":3,"column":17,"offset":366},"end":{"line":3,"column":118,"offset":467}}}],"position":{"start":{"line":3,"column":1,"offset":350},"end":{"line":3,"column":118,"offset":467}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You have probably read about that problem before somewhere. The problem might seem staged, but when it comes to computers, it is a real issue. A real issue that has been solved by TCP/IP. In this article, I try to explain the two most popular algorithms for distributed consensus - Paxos and Raft. They solve a similar issue:","position":{"start":{"line":5,"column":1,"offset":469},"end":{"line":5,"column":326,"offset":794}}}],"position":{"start":{"line":5,"column":1,"offset":469},"end":{"line":5,"column":326,"offset":794}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You have a cluster of ","position":{"start":{"line":7,"column":1,"offset":796},"end":{"line":7,"column":23,"offset":818}}},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"n","position":{"start":{"line":7,"column":24,"offset":819},"end":{"line":7,"column":25,"offset":820}}}],"position":{"start":{"line":7,"column":23,"offset":818},"end":{"line":7,"column":26,"offset":821}}},{"type":"text","value":" servers. Each of the servers might fail at any time. A constant flow of random messages hits each of the servers. How do you make the cluster agree on what messages are received and in what order?","position":{"start":{"line":7,"column":26,"offset":821},"end":{"line":7,"column":223,"offset":1018}}}],"position":{"start":{"line":7,"column":1,"offset":796},"end":{"line":7,"column":223,"offset":1018}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"The short answer is:","position":{"start":{"line":9,"column":2,"offset":1021},"end":{"line":9,"column":22,"offset":1041}}}],"position":{"start":{"line":9,"column":1,"offset":1020},"end":{"line":9,"column":23,"offset":1042}}},{"type":"text","value":" It is complicated.","position":{"start":{"line":9,"column":23,"offset":1042},"end":{"line":9,"column":42,"offset":1061}}}],"position":{"start":{"line":9,"column":1,"offset":1020},"end":{"line":9,"column":42,"offset":1061}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"The long answer is:","position":{"start":{"line":11,"column":2,"offset":1064},"end":{"line":11,"column":21,"offset":1083}}}],"position":{"start":{"line":11,"column":1,"offset":1063},"end":{"line":11,"column":22,"offset":1084}}}],"position":{"start":{"line":11,"column":1,"offset":1063},"end":{"line":11,"column":22,"offset":1084}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"What are Distributed-State-Machines?","position":{"start":{"line":13,"column":1,"offset":1086},"end":{"line":13,"column":37,"offset":1122}}}],"position":{"start":{"line":13,"column":1,"offset":1086},"end":{"line":14,"column":37,"offset":1159}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As mentioned above, there are two main algorithms for reaching consensus in a distributed system.","position":{"start":{"line":16,"column":1,"offset":1161},"end":{"line":16,"column":98,"offset":1258}}}],"position":{"start":{"line":16,"column":1,"offset":1161},"end":{"line":16,"column":98,"offset":1258}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before we get to explaining the algorithms, let us look into what reaching consensus in a distributed system means. To understand what that means, it is useful to understand what a state machine is. A state machine is a system that stores a state, and given an action goes to another state. What consensus in a distributed system means is that we are able to treat a system of multiple machines as a state machine. That is useful for programmers because they do not have to think about the distributed nature of the system.","position":{"start":{"line":18,"column":1,"offset":1260},"end":{"line":18,"column":524,"offset":1783}}}],"position":{"start":{"line":18,"column":1,"offset":1260},"end":{"line":18,"column":524,"offset":1783}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"How about giving machines roles?","position":{"start":{"line":20,"column":1,"offset":1785},"end":{"line":20,"column":33,"offset":1817}}}],"position":{"start":{"line":20,"column":1,"offset":1785},"end":{"line":21,"column":33,"offset":1850}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ok, so we are trying to create a distributed state machine. First, consider a system with a single machine. We send a message to the machine and it stores them in the same order as they were received. That machine is the leader.","position":{"start":{"line":23,"column":1,"offset":1852},"end":{"line":23,"column":229,"offset":2080}}}],"position":{"start":{"line":23,"column":1,"offset":1852},"end":{"line":23,"column":229,"offset":2080}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Leader","position":{"start":{"line":25,"column":1,"offset":2082},"end":{"line":25,"column":7,"offset":2088}}}],"position":{"start":{"line":25,"column":1,"offset":2082},"end":{"line":26,"column":7,"offset":2095}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The leader is the machine that receives all the messages. If we only have a single machine, and call that machine the leader it might not be a distributed system, but it gets the basic point across.","position":{"start":{"line":28,"column":1,"offset":2097},"end":{"line":28,"column":199,"offset":2295}}}],"position":{"start":{"line":28,"column":1,"offset":2097},"end":{"line":28,"column":199,"offset":2295}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Followers","position":{"start":{"line":30,"column":1,"offset":2297},"end":{"line":30,"column":10,"offset":2306}}}],"position":{"start":{"line":30,"column":1,"offset":2297},"end":{"line":31,"column":10,"offset":2316}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we have the leader we need more machines in the system. We’ll call the machines followers. They also store the state of the system and check whether the leader is alive.","position":{"start":{"line":33,"column":1,"offset":2318},"end":{"line":33,"column":175,"offset":2492}}}],"position":{"start":{"line":33,"column":1,"offset":2318},"end":{"line":33,"column":175,"offset":2492}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If they suspect the leader is dead they tries to become the leader.","position":{"start":{"line":35,"column":1,"offset":2494},"end":{"line":35,"column":68,"offset":2561}}}],"position":{"start":{"line":35,"column":1,"offset":2494},"end":{"line":35,"column":68,"offset":2561}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Candidate","position":{"start":{"line":37,"column":1,"offset":2563},"end":{"line":37,"column":10,"offset":2572}}}],"position":{"start":{"line":37,"column":1,"offset":2563},"end":{"line":38,"column":11,"offset":2584}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"That is a machine that is trying to become the new leader. For it to become the leader, all the other machines have to agree that it is the leader.","position":{"start":{"line":40,"column":1,"offset":2586},"end":{"line":40,"column":148,"offset":2733}}}],"position":{"start":{"line":40,"column":1,"offset":2586},"end":{"line":40,"column":148,"offset":2733}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"So what does is the lifecycle?","position":{"start":{"line":42,"column":1,"offset":2735},"end":{"line":42,"column":31,"offset":2765}}}],"position":{"start":{"line":42,"column":1,"offset":2735},"end":{"line":43,"column":31,"offset":2796}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With these roles in place, we have set the play for a lifecycle. Firstly, let us assume that every machine is a follower. The machines then elect a leader.","position":{"start":{"line":45,"column":1,"offset":2798},"end":{"line":45,"column":156,"offset":2953}}}],"position":{"start":{"line":45,"column":1,"offset":2798},"end":{"line":45,"column":156,"offset":2953}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A machine becomes the leader","position":{"start":{"line":47,"column":5,"offset":2959},"end":{"line":47,"column":33,"offset":2987}}}],"position":{"start":{"line":47,"column":1,"offset":2955},"end":{"line":48,"column":1,"offset":2988}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Messages are received by the leader","position":{"start":{"line":49,"column":5,"offset":2993},"end":{"line":49,"column":40,"offset":3028}}}],"position":{"start":{"line":49,"column":1,"offset":2989},"end":{"line":50,"column":1,"offset":3029}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The leader dies","position":{"start":{"line":51,"column":5,"offset":3034},"end":{"line":51,"column":20,"offset":3049}}}],"position":{"start":{"line":51,"column":1,"offset":3030},"end":{"line":52,"column":1,"offset":3050}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Repeat…","position":{"start":{"line":53,"column":5,"offset":3055},"end":{"line":53,"column":14,"offset":3064}}}],"position":{"start":{"line":53,"column":1,"offset":3051},"end":{"line":53,"column":14,"offset":3064}}},{"type":"text","value":"\n"}],"position":{"start":{"line":47,"column":1,"offset":2955},"end":{"line":53,"column":14,"offset":3064}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You now hopefully understand how the algorithms work.","position":{"start":{"line":55,"column":1,"offset":3066},"end":{"line":55,"column":54,"offset":3119}}}],"position":{"start":{"line":55,"column":1,"offset":3066},"end":{"line":55,"column":54,"offset":3119}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Where do Paxos and Raft differ?","position":{"start":{"line":57,"column":1,"offset":3121},"end":{"line":57,"column":32,"offset":3152}}}],"position":{"start":{"line":57,"column":1,"offset":3121},"end":{"line":58,"column":32,"offset":3184}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In leader election.","position":{"start":{"line":60,"column":1,"offset":3186},"end":{"line":60,"column":20,"offset":3205}}}],"position":{"start":{"line":60,"column":1,"offset":3186},"end":{"line":60,"column":20,"offset":3205}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Paxos requires the leader to be up to date.","position":{"start":{"line":62,"column":1,"offset":3207},"end":{"line":62,"column":44,"offset":3250}}}],"position":{"start":{"line":62,"column":1,"offset":3207},"end":{"line":62,"column":44,"offset":3250}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Raft fetches the messages from the other state machines.","position":{"start":{"line":64,"column":1,"offset":3252},"end":{"line":64,"column":57,"offset":3308}}}],"position":{"start":{"line":64,"column":1,"offset":3252},"end":{"line":64,"column":57,"offset":3308}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"-","position":{"start":{"line":66,"column":1,"offset":3310},"end":{"line":66,"column":2,"offset":3311}}}],"position":{"start":{"line":66,"column":1,"offset":3310},"end":{"line":66,"column":2,"offset":3311}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":67,"column":1,"offset":3312}}}}