{"componentChunkName":"component---src-templates-post-template-js","path":"/gallop/","result":{"data":{"site":{"siteMetadata":{"title":"Complex Codes"}},"markdownRemark":{"id":"d953790c-3717-51c8-b374-2e21fa646702","excerpt":"Collecting information about the people visiting your site is crutial - if you want to know who is visiting your site. In the case of this blog, I would like to know if anyone is reading my posts. A lot of great solutions already exist. The most popular one is Google Analytics. Their ‘free’ offering will work perfectly for most people and is used by most sites you visit. I don’t like the business…","html":"<p>Collecting information about the people visiting your site is crutial - if you want to know who is visiting your site. In the case of this blog, I would like to know if anyone is reading my posts. A lot of great solutions already exist. The most popular one is <em>Google Analytics</em>. Their ‘free’ offering will work perfectly for most people and is used by most sites you visit.</p>\n<p>I don’t like the business model of <em>Google Analytics</em>. It exists to serve advertisers - so it tries to collect as much information as possible. Also, not all of that information is exposed to the entity running the site. For example, there is no way to export all data collected by <em>Google Analytics</em>. That means that at some point you will have to opt into their <em>Google Analytics 360</em> plan - which offers deeper insights but is way to expensive for most people/companies.</p>\n<p>So I decided to create my own “Google Analytics” - <strong>with a focus on privacy</strong>.</p>\n<h2>But wait… have you considered other options?</h2>\n<p>“Google Analytics” is far from the only analytics platform out there. Some of the ones I have considered are:</p>\n<ul>\n<li>Heap Analytic</li>\n<li>Amplitude</li>\n<li>Simple Analytics</li>\n</ul>\n<p>Just to be clear, I do not think this solution will be better than any of those. The main purpose of this solution is killing time and having something to write about.</p>\n<h2>So what is an analytics platform?</h2>\n<p>To me, an analytics platform is <strong>a system for aggregating events</strong>. In that defenition there are two main words that need explaination - <strong>event</strong> and <strong>aggregation</strong>.</p>\n<p>Let’s start by looking at what I mean by an <strong>event</strong>. An event in this context can be any action the user is doing on the site - loading the page, clicking a button, hovering the mouse over an element… You get the point. In code, that event could look something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">struct</span> Event <span class=\"token punctuation\">{</span>\n    id<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">,</span>\n    session_id<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">,</span> <span class=\"token comment\">// Identifier for the session.</span>\n    tag<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">,</span> <span class=\"token comment\">// What action?</span>\n    timestamp<span class=\"token punctuation\">:</span> u64<span class=\"token punctuation\">,</span> <span class=\"token comment\">// When?</span>\n    browser<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">,</span> <span class=\"token comment\">// With what browser.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>These events will be generated while the user is visiting the site throught a tracking script. This tracking script will send events back to the server. The server will recieve an event that looks something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"session_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"tag\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hit\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"timestamp\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1231</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"browser\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Chrome 17.1\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The amount of these events varey. Some trackers track every mouse movement, while other trackers only track when a user enters a site. If there are a lot of these events there is no longer a point to looking at single events. We need to get the bigger picture.</p>\n<p>This is where aggregations come in. Let’s say we have 1000 of the events above. Possible insights could be:</p>\n<ul>\n<li>What browsers are the users using?</li>\n<li>How many pages does the average user visit?</li>\n<li>How long does the average user stay on the site?</li>\n</ul>\n<p>To answer these questions we need to do aggregations. Aggregations in simple terms is calculating something based on a set of events. If you are familiar with functional programming, most aggregations can be formulated as a reduce step. Something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function\">average_page_views_per_session</span><span class=\"token punctuation\">(</span>events<span class=\"token punctuation\">:</span> Vec<span class=\"token punctuation\">[</span>Event<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> f32 <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> unique_sessions<span class=\"token punctuation\">:</span> f32 <span class=\"token operator\">=</span> <span class=\"token function\">get_unique_sessions</span><span class=\"token punctuation\">(</span>events<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  events<span class=\"token punctuation\">.</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f32 <span class=\"token operator\">/</span> unique_sessions\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Doing these aggregations and letting the user query them is the main job of an analytics platform.</p>\n<h2>I understand, but where does Gallop come in?</h2>\n<p>Gallop is not a analytics platform, or at least that is not the goal. The main goal of Gallop is to create a simple API where user submitted events can be processed and insights generated.</p>\n<p>I want to be able to build a dashboard on top of that GraphQL API that can show staticsics of the people visiting my site.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 530px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7aed276cfd81874a6de260c01b944791/b6a9b/Drawing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAB/0lEQVQoz2P432lpA8Sufzss7P/3Wdn+n2htDaY7Le3/dVo6g/B/Bvxg+vTpCA5QowuSHA8DA68UhIbKd5jJXu+L9ayYvUlu9rRJakDNqiA8bdo0FSCtCcS8KIYCDfQAuk7yf4+V6Kl8I9mNUXJyBzL15P92WIoD5cT+d1rYvO72kmRY959p0dQedqBBbEDNIJoRSEsCsRzUQEawoUBNgkBs/K/DwuB/j6X+nUkJfv/7HI3+d5jr/wOJd1pKo3vxfyWEXji1V2jutImyIPaNvmhmoDmMGOFRMGubBrrYm24vJob1/xlO9GegiIfNPcdXNHu7JKptnZa8IJf877XU/d9jrfe0P8Txf4+5zv9uKz2gq4EutBJHVv+vw1Ltf5eVwf9uA42H/RHOtybEev7v1lf/12VtAJTTYAAa5gY0VOpMgZH8xSIj+Qcl2tLnCo3l71SYyAI1igO9bnOrL0qO4cR/pu+d9vrAMDV412AmdrnEROFWoZbM42INqXNFJgofGs3E/3dZqoFc6Ai2mkUEGBb8QOeLAANZSJmBQVgOEsta4qf706MKZ++Qe9/l5o5wq4AMUA1Qj5AEA4OgIlCAER7LQKfq/p9sLfK/30ryZ5uFFNAmyR9tFhJ/OiyUgT7w+d/AyAIx3EQByAd60VIUGIGSIHVA/ZIgNjB4xIFy9gDXqOOEpFSK+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Hello world\"\n        title=\"Hello world\"\n        src=\"/static/7aed276cfd81874a6de260c01b944791/b6a9b/Drawing.png\"\n        srcset=\"/static/7aed276cfd81874a6de260c01b944791/12f09/Drawing.png 148w,\n/static/7aed276cfd81874a6de260c01b944791/e4a3f/Drawing.png 295w,\n/static/7aed276cfd81874a6de260c01b944791/b6a9b/Drawing.png 530w\"\n        sizes=\"(max-width: 530px) 100vw, 530px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>So events generated when people visit the different pages on my site will be collected and aggregated with an indexer. This indexer will put the events into an index where they can be easily queried.</p>\n<p>I will write more blog posts about the different aspects of the projects. The next one will be about the GraphQL API.</p>\n<h2>Sounds cool. What will the finnished project look like?</h2>\n<p>Except from the fact that the project probably will never be finnished.</p>\n<ol>\n<li>There will be a dashboard on this site where users can see how many people have visited the site. There will also be analytics on a per article level. Hopefully this can be added to the statis site generor.</li>\n</ol>","frontmatter":{"title":"Gallop: An analytics database written in Rust","date":"April 27, 2020","description":"","draft":false}}},"pageContext":{"slug":"/gallop/","previous":null,"next":{"fields":{"slug":"/postgres-vs-mysql/"},"frontmatter":{"title":"Postgres VS MySQL"}}}}}